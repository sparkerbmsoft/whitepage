<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Information</title>
</head>
<body>

<a href="#" onclick="getDeviceInfo()">Click here to get information</a>

<table id="userInfoTable" border="1">
    <thead>
        <tr>
            <th>Property</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <!-- Table content will be dynamically added here -->
    </tbody>
</table>

<script>
function getDeviceInfo() {
    // Get device information
    const device = {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
    };

    // Get location information (requires the user's consent)
    navigator.geolocation.getCurrentPosition(
        position => {
            const location = {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
            };

            // Display the information
            displayInformation(device, location);
        },
        error => {
            console.error(error.message);
            
            // If location access is denied or there's an error, still display device information
            displayInformation(device);
        }
    );
}

function displayInformation(device, location) {
    const tableBody = document.querySelector('#userInfoTable tbody');

    // Clear previous content
    tableBody.innerHTML = '';

    // Add device information to the table
    addRowToTable(tableBody, 'User Agent', device.userAgent);
    addRowToTable(tableBody, 'Platform', device.platform);

    // Add location information to the table if available
    if (location) {
        addRowToTable(tableBody, 'Latitude', location.latitude);
        addRowToTable(tableBody, 'Longitude', location.longitude);

        // Reverse geocoding using OpenCage Geocoding API
        const apiKey = 'e8711fb09d774da2b4400b27ff8d135f';
        const apiUrl = `https://api.opencagedata.com/geocode/v1/json?q=${location.latitude}+${location.longitude}&key=${apiKey}`;
        
        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                if (data.results.length > 0) {
                    const locationName = data.results[0].formatted;
                    addRowToTable(tableBody, 'Location Name', locationName);
                } else {
                    addRowToTable(tableBody, 'Location Name', 'Not available');
                }
            })
            .catch(error => {
                console.error('Error fetching location information:', error);
                addRowToTable(tableBody, 'Location Name', 'Error fetching');
            });
    }
}

function addRowToTable(tableBody, property, value) {
    const row = tableBody.insertRow();
    const cell1 = row.insertCell(0);
    const cell2 = row.insertCell(1);
    cell1.textContent = property;
    cell2.textContent = value;
}
</script>

</body>
</html>
